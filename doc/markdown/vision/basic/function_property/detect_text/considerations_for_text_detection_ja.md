# テキスト検出に関する考慮事項 (Vision)

**Shirates/Vision** ではテキスト検出に **AI-OCR** を使用しますが、AI-OCRは精度の問題があるため、これを考慮する必要があります。

## テキストの誤検出

テキストの誤検出のパターンとしては以下のものがあります。

1. 本来と異なる文字として検出されたり一部が欠けたりする
2. 文字ではない画像（アイコンなど）が文字として検出される
3. テキストのバウンディングボックスが検出されない

## 1.本来と異なる文字として検出されたり一部が欠けたりする

AI-OCRは特定の文字に対して誤検出しやすい場合があります。

### 誤検出の例

| 本来の文字   | 誤検出の例  | 誤検出された文字 |
|:--------|:-------|:---------|
| 送信      | 送言     | `信`      |
| 電気通信事業法 | 電気通事業法 | `信`      |
| 配偶者     | 配者     | `偶`      |
| チラシ     | チラン    | `シ`      |
| 【39円引】  | 139円引】 | `【`      |
| 生ガ      | 生が     | `ガ`      |
| 軽減税率    | 経減税率   | `軽`      |
| 末尾      | 未尾     | `末`      |
| 数量      | 数豆     | `量`      |
| 数量      | 数亜     | `量`      |

### 対策

エラッタ（訂正表）を使用します。<br>
参照 [AI-OCRによるテキスト認識](../../text_and_image_recognition/text_recognition_by_ai_ocr_ja.md)

## 2. 文字ではない画像（アイコンなど）が文字として検出される

### 誤検出の例

![](../../text_and_image_recognition/_images/text_recognition_errors_ja.png)

| 本来の文字      | 誤検出の例         | アイコン画像部分の文字 |
|:-----------|:--------------|:------------|
| 設定を検索      | Q 設定を検索       | `Q`         |
| 音とバイブレーション | 4) 音とバイブレーション | `4)`        |

### 対策

以下の関数ではテキストを検出する際に **ルースマッチング(loose matching)** がデフォルトで機能します。<br>

- detect
- exist
- canDetect
- tap

ルースマッチングは文字列の両端を左最大3文字、右最大2文字までトリムして文字列のマッチングを試行します。
ルースマッチングを使用すると以下のように本来検出したい文字列を指定することができます。

```kotlin
it.exist("設定を検索")   // OK
it.exist("ネットワークとインターネット")  // OK
it.exist("音とバイブレーション")  // OK
```

ルースマッチングを使用したくない場合は `looseMatch = false` を引数として指定するとルースマッチングを無効化できます。

```kotlin
it.exist("設定を検索", looseMatch = false)  // NG
it.exist("ネットワークとインターネット", looseMatch = false)  // OK
it.exist("音とバイブレーション", looseMatch = false)  // NG
```

## 3. テキストのバウンディングボックスが検出されない

背景色に対して文字色のコントラストが低い場合はテキストのバウンディングボックスが検出されない場合があります。<br>
この場合は **画像フィルター** を適用することで改善する場合があります。

画像フィルターは `autoImageFilter = true` を引数として指定することで有効化できます。

```kotlin
it.exist("コントラストの低いテキスト", autoImageFilter = true)
```

### Link

- [index](../../../../index_ja.md)
