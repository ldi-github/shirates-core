<!doctype html>
<html lang="en">
 <head>
  <meta charset="utf-8">
  <link rel="stylesheet" href="../../main.css">
 </head>
 <body>
  <div id="readme" class="Box">
   <article class="markdown-body container-lg">
    <h1>Creating screen nickname file</h1>
    <p>Creating screen nickname file is important to make testing easy.</p>
    <p>There are several patterns with defining unique screen identity.</p>
    <ol>
     <li>Fixed layout</li>
     <li>Scrolling layout with fixed header</li>
     <li>Scrolling layout without fixed header</li>
    </ol>
    <p>The latter is harder than the former.</p>
    <h2>Example 1: Fixed layout</h2>
    <p>Open Android Settings app.</p>
    <p>Let’s see <code>[Connected devices Screen]</code> as example.</p>
    <p><img src="../_images/connected_devices_screen_1.png" alt=""></p>
    <ol>
     <li>Create <code>screens</code> directory (if it does not exist).</li>
     <li>Create a file with name <code>[Connected devices Screen].json</code>.</li>
    </ol>
    <p><img src="../_images/create_connected_decives_screen_json.png" alt=""></p>
    <ol>
     <li>Edit content as follows. <strong>key</strong> must be the same as the file name(without extension). ( See <a href="../../basic/selector_and_nickname/nickname/screen_nickname.html">Screen nickname</a> )</li>
    </ol>
    <pre><code>{
  "key": "[Connected devices Screen]",

  "identity": "",

  "selectors": {
  }
}
</code></pre>
    <ol>
     <li><p>Capture <code>Connected Devices</code> screen in Appium Inspector. (See <a href="using_appium_inspector.html">Using Appium Inspector</a>)</p>
      <ol>
       <li>Start appium.</li>
       <li>Start Android 12 emulator.</li>
       <li>Start Appium Inspector.</li>
       <li>Edit capabilities for Android 12 emulator to start session of <code>Settings</code> app. Click <code>Start Session</code>.</li>
       <li>Tap <code>Connected devices</code> in the emulator.</li>
       <li>Tap <code>Refresh source &amp; screenshot</code> in Appium Inspector to capture <code>Connected devices</code> screen. <br><img src="../_images/refresh_source_and_screenshot.png" alt=""></li>
      </ol></li>
     <li><p>Look at the screen and define selector names. At this point values may be "" (empty). <br><img src="../_images/connected_devices_screen_edit_1.png" alt=""></p></li>
    </ol>
    <pre><code>{
  "key": "[Connected devices Screen]",

  "identity": "",

  "selectors": {
    "[&lt;-]": "",
    "[Connected devices]": "",
    "[+]": "",
    "[Pair new device]": "",
    "[Previously connected devices]": "",
    "[&gt;]": "",
    "[See all]": "",
    "[Connection preferences]": "",
    "{Connection preferences}": "",
    "[i]": "",
    "{Information}": ""
  }
}
</code></pre>
    <ol>
     <li>Inspect each elements to find unique attribute(s). (See <a href="../../basic/selector_and_nickname/selector_expression.html">Selector expression</a>) 
      <ul>
       <li><code>[&lt;-]</code> is filtered uniquely by content-desc ‘<code>Navigate up</code>’. <br><img src="../_images/inspect_element_1.png" alt=""> <br>
        So you can define the selector as follows using <strong>accessibility filter</strong>. <br><code>"[&lt;-]": "@Navigate up"</code> <br><br></li>
       <li><code>[Connected devices]</code> is filtered uniquely by content-desc ‘<code>Connected devices</code>’. <br><img src="../_images/inspect_element_2.png" alt=""> <br>
        So you can define the selector as follows using <strong>accessibility filter</strong>. <br><code>"[Connected devices]": "@Connected devices"</code> <br><br></li>
       <li><code>[Pair new device]</code> is filtered uniquely by text. <br><img src="../_images/inspect_element_3.png" alt=""> <br>
        So you can define the selector as follows using <strong>text filter</strong>. <br><code>"[Pair new device]": "Pair new device"</code> <br><br>
        In this case, the value can be omitted because the text is the same as nickname label(without brackets). ( See <a href="../../basic/selector_and_nickname/nickname/selector_nickname.html">Selector nickname</a>) <br><code>"[Pair new device]": ""</code> <br><br></li>
       <li><code>[+]</code> is not filtered uniquely by its attributes. <br><img src="../_images/inspect_element_4.png" alt=""> <br>
        In this case, consider using <a href="../../basic/selector_and_nickname/relative_selector/relative_selector.html">Relative selector</a>. You can define the selector as follows using <code>:leftImage</code>. See <a href="../../basic/selector_and_nickname/relative_selector/relative_selector_direction.html">Relative selector(Direction based)</a> <br><code>"[+]": "[Pair new device]:leftImage"</code> <br><br></li>
       <li><code>[Connection preferences]</code> is filtered uniquely by text. <br><img src="../_images/inspect_element_5.png" alt=""> <br>
        So you can define the selector as follows using <strong>text filter</strong>. <br><code>"[Connection preferences]": ""</code> <br><br></li>
       <li><code>Bluetooth, Android Auto</code> is dynamic content of <code>[Connection preferences]</code>, and is not filtered uniquely by its attributes. <br><img src="../_images/inspect_element_6.png" alt=""> <br>
        In this case, consider using <a href="../../basic/selector_and_nickname/relative_selector/relative_selector.html">Relative selector</a>. You can define the selector as follows using <code>:belowLabel</code>. See <a href="../../basic/selector_and_nickname/relative_selector/relative_selector_direction.html">Relative selector(Direction based)</a> <br><code>"{Connection preferences}": "[Connection preferences]:belowLabel"</code> <br><br></li>
       <li>Inspect the rest of elements and edit all selector nicknames. Finally, you can get selectors as follows.</li>
      </ul></li>
    </ol>
    <pre><code>{
  "key": "[Connected devices Screen]",

  "identity": "",

  "selectors": {
    "[&lt;-]": "@Navigate up",
    "[Connected devices]": "@Connected devices",
    "[+]": "[Pair new device]:leftImage",
    "[Pair new device]": "",
    "[Previously connected devices]": "",
    "[&gt;]": "[See all]:leftImage",
    "[See all]": "",
    "[Connection preferences]": "",
    "{Connection preferences}": "[Connection preferences]:belowLabel",
    "[i]": "{Information}:aboveImage",
    "{Information}": "Visible as *"
  }
}
</code></pre>
    <ol>
     <li>Set <code>identity</code> combining selector nicknames to make it unique identity.</li>
    </ol>
    <pre><code>{
  "key": "[Connected devices Screen]",

  "identity": "[Connected devices][Pair new device][See all]",

  "selectors": {
    "[&lt;-]": "@Navigate up",
    "[Connected devices]": "@Connected devices",
    "[+]": "[Pair new device]:leftImage",
    "[Pair new device]": "",
    "[Previously connected devices]": "",
    "[&gt;]": "[See all]:leftImage",
    "[See all]": "",
    "[Connection preferences]": "",
    "{Connection preferences}": "[Connection preferences]:belowLabel",
    "[i]": "{Information}:aboveImage",
    "{Information}": "Visible as *"
  }
}
</code></pre>
    <ol>
     <li>Create <code>ConnectedDevicesTest.kt</code> under <code>kotlin/exercise</code> directory.</li>
    </ol>
    <pre><code>package exercise

import org.junit.jupiter.api.Test
import shirates.core.configuration.Testrun
import shirates.core.driver.commandextension.*
import shirates.core.testcode.UITest

@Testrun("testConfig/android/androidSettings/testrun.properties")
class ConnectedDevicesTest : UITest() {

    @Test
    fun test1() {

        scenario {
            case(1) {
                condition {
                    it.tap("Connected devices")
                }.expectation {
                    it.screenIs("[Connected devices Screen]")
                        .exist("[&lt;-]").accessIs("Navigate up")
                        .exist("[Connected devices]").accessIs("Connected devices")
                        .exist("[+]").classIs("android.widget.ImageView")
                        .exist("[Pair new device]").textIs("Pair new device")
                        .exist("[Previously connected devices]").textIs("Previously connected devices")
                        .exist("[&gt;]").classIs("android.widget.ImageView")
                        .exist("[See all]").textIs("See all")
                        .exist("[Connection preferences]").textIs("Connection preferences")
                        .exist("{Connection preferences}").textIs("Bluetooth, Android Auto")
                        .exist("[i]").classIs("android.widget.ImageView")
                        .exist("{Information}").textStartsWith("Visible as ")
                }
            }
            case(2) {
                action {
                    it.tap("[&lt;-]")
                }.expectation {
                    it.exist("Network &amp; internet")
                }
            }
        }
    }

}
</code></pre>
    <ol>
     <li>Run test. You can get a Html-report as follows when configured correctly. <br><img src="../_images/connected_devices_test_result.png" alt=""></li>
    </ol>
    <p><br></p>
    <h2>Example 2: Scrolling layout with fixed header</h2>
    <p>Open Android Settings app.</p>
    <p>Let’s see <code>[Network &amp; internet Screen]</code> as example.</p>
    <p><img src="../../in_action/_images/screen_nickname_identity_with_fixed_header_1.png" alt="Optimizing end of scroll"> <img src="../../in_action/_images/screen_nickname_identity_with_fixed_header_2.png" alt="Optimizing end of scroll"></p>
    <p>This screen is scrollable and has fixed header area <code>&lt;#collapsing_toolbar&gt;</code>. In this case, you can define <code>identity</code> as follows.</p>
    <pre><code>{
  "key": "[Network &amp; internet Screen]",

  "identity": "#collapsing_toolbar&amp;&amp;@Network &amp; internet",
</code></pre>
    <p>This is enough, but you can simply use <strong>title selector</strong>. ( See <a href="../../basic/selector_and_nickname/special_selector/title_selector.html">title selector</a>)</p>
    <pre><code>{
  "key": "[Network &amp; internet Screen]",

  "identity": "~title=Network &amp; internet",
</code></pre>
    <p><br></p>
    <p>Screen nickname file for <code>[Network &amp; internet Screen]</code> can be described as follows.</p>
    <p><strong>[Network &amp; internet Screen].json</strong></p>
    <pre><code>{
  "key": "[Network &amp; internet Screen]",

  "include": [
  ],

  "identity": "~title=Network &amp; internet",

  "selectors": {
    "[&lt;-]": "@Navigate up",
    "[Network &amp; internet]": "@Network &amp; internet",

    "[Internet]": "",
    "{Internet}": "[Internet]:label",

    "[Calls &amp; SMS]": "",
    "{Calls &amp; SMS}": "[Calls &amp; SMS]:label",

    "[SIMs]": "",
    "{SIMs}": "[SIMs]:label",

    "[Airplane mode]": "",
    "{Airplane mode switch}": "[Airplane mode]:switch",

    "[Hotspot &amp; tethering]": "",
    "{Hotspot &amp; tethering}": "[Hotspot &amp; tethering]:label",

    "[Data Saver]": "",
    "{Data Saver}": "[Data Saver]:label",

    "[VPN]": "",
    "{VPN}": "[VPN]:label",

    "[Mobile plan]": "",
    "{Mobile plan}": "[Mobile plan]:label",

    "[Private DNS]": "",
    "{Private DNS}": "[Private DNS]:label",

    "[Adaptive connectivity]": "",
    "{Adaptive connectivity}": "[Adaptive connectivity]:label",

  },

  "scroll": {
    "start-elements": "",
    "end-elements": "[Adaptive connectivity]",
    "overlay-elements": ""
  }
}
</code></pre>
    <h3>:label</h3>
    <p>In this example, relative selector<code>:label</code> is used instead of <code>:belowLabel</code>. <code>:label</code> searches the nearest label in widget flow.</p>
    <p>See <a href="../../basic/selector_and_nickname/relative_selector/relative_selector_flow.html">Relative selector(Widget flow based)</a> .</p>
    <h3>:switch</h3>
    <p>Relative selector <code>:switch</code> searches the nearest switch in widget flow.</p>
    <p>See <a href="../../basic/selector_and_nickname/relative_selector/relative_selector_flow.html">Relative selector(Widget flow based)</a> .</p>
    <h3>“scroll” section</h3>
    <p><code>"scroll"</code> section is for optimization (optional).</p>
    <p><code>start-elements</code> and <code>end-elements</code> are for detecting end of scroll efficiently. See <a href="../../in_action/performance_resource/end_of_scroll.html">Optimizing end of scroll</a></p>
    <p><code>overlay-elements</code> is for detecting overlay elements. Elements under overlay-elements are considered as not displayed.</p>
    <p><br></p>
    <h2>Example 3: Scrolling layout without fixed header</h2>
    <p>Open Android Settings app.</p>
    <p>Let’s see <code>[Android Settings Top Screen]</code> as example.</p>
    <p><img src="../_images/settings_1.png" alt=""></p>
    <ol>
     <li>Open shirates-core project.</li>
     <li>Open <code>[Android Settings Top Screen].json</code> under <code>testConfig/android/androidSettings/screens</code>.</li>
    </ol>
    <pre><code>{
  "key": "[Android Settings Top Screen]",

  "identity": "#recycler_view",
  "satellites": ["Battery", "Accessibility", "Passwords &amp; accounts", "Tips &amp; support"],

  "selectors": {
    "[Account Avatar]": "#account_avatar",
    "[Settings]": "#homepage_title",

    "[Search Button]": "&lt;#search_action_bar&gt;:inner(1)",
    "[Search settings]": "#search_action_bar_title",

    "[Network &amp; internet]": "",
    "{Network &amp; internet}": "[Network &amp; internet]:label",
    "[Network &amp; internet Icon]": "[Network &amp; internet]:leftImage",

    "[Connected devices]": "",
    "{Connected devices}": "[Connected devices]:label",
    "[Connected devices Icon]": "[Connected devices]:leftImage",

    "[Apps]": "",
    "{Apps}": "[Apps]:label",
    "[Apps Icon]": "[Apps]:leftImage",

    "[Notifications]": "",
    "{Notifications}": "[Notifications]:label",
    "[Notifications Icon]": "[Notifications]:leftImage",

    "[Battery]": "",
    "{Battery}": "[Battery]:label",
    "[Battery Icon]": "[Battery]:leftImage",

    "[Storage]": "",
    "{Storage}": "[Storage]:label",
    "[Storage Icon]": "[Storage]:leftImage",

    "[Sound &amp; vibration]": "",
    "{Sound &amp; vibration}": "[Sound &amp; vibration]:label",
    "[Sound &amp; vibration Icon]": "[Sound &amp; vibration]:leftImage",

    "[Display]": "",
    "{Display}": "[Display]:label",
    "[Display Icon]": "[Display]:leftImage",

    "[Wallpaper &amp; style]": "",
    "{Wallpaper &amp; style}": "[Wallpaper &amp; style]:label",
    "[Wallpaper &amp; style Icon]": "[Wallpaper &amp; style]:leftImage",

    "[Accessibility]": "",
    "{Accessibility}": "[Accessibility]:label",
    "[Accessibility Icon]": "[Accessibility]:leftImage",

    "[Security]": "",
    "{Security}": "[Security]:label",
    "[Security Icon]": "[Security]:leftImage",

    "[Privacy]": "",
    "{Privacy}": "[Privacy]:label",
    "[Privacy Icon]": "[Privacy]:leftImage",

    "[Location]": "",
    "{Location}": "[Location]:label",
    "[Location Icon]": "[Location]:leftImage",

    "[Safety &amp; emergency]": "",
    "{Safety &amp; emergency}": "[Safety &amp; emergency]:label",
    "[Safety &amp; emergency Icon]": "[Safety &amp; emergency]:leftImage",

    "[Passwords &amp; accounts]": "",
    "{Passwords &amp; accounts}": "[Passwords &amp; accounts]:label",
    "[Passwords &amp; accounts Icon]": "[Passwords &amp; accounts]:leftImage",

    "[Google]": "",
    "{Google}": "[Google]:label",
    "[Google Icon]": "[Google]:leftImage",

    "[System]": "",
    "{System}": "[System]:label",
    "[System Icon]": "[System]:leftImage",

    "[About emulated device]": "",
    "{About emulated device}": "[About emulated device]:label",
    "[About emulated device Icon]": "[About emulated device]:leftImage",

    "[About phone]": "",
    "{About phone}": "[About phone]:label",
    "[About phone Icon]": "[About phone]:leftImage",

    "[Tips &amp; support]": "",
    "{Tips &amp; support}": "[Tips &amp; support]:label",
    "[Tips &amp; support Icon]": "[Tips &amp; support]:leftImage",

    "[:Summary]": ":belowLabel"
  },

  "scroll": {
    "start-elements": "[Network &amp; internet]",
    "end-elements": "{Tips &amp; support}",
    "overlay-elements": "[Search Button][Search settings]"
  }
}
</code></pre>
    <p><br></p>
    <h3>“identity” and “satellites”</h3>
    <p>If you can always access elements that consist of screen identity, you should use these elements for <code>identity</code>. The former <strong>Example 1</strong> and <strong>Example 2</strong> are in this case.</p>
    <p>If you can not always access such elements, you should consider another workaround. In case of <code>[Android Settings Top Screen]</code>, you can scroll up or down.</p>
    <p><img src="../../in_action/_images/screen_nickname_identity_without_fixed_header.png" alt="Optimizing end of scroll"></p>
    <p>This screen does not have fixed header area. While scrolling there is no position-fixed element for <code>"identity"</code>. In this case you can use <code>"satellites"</code> to complement unique key for screen identification. <code>"satellites</code> is a list of selector.</p>
    <p>In <code>[Android Settings Top Screen].json</code>, you can specify <code>"identity"</code> and <code>"satellites"</code> as follows.</p>
    <pre><code>{
  "key": "[Android Settings Top Screen]",

  "identity": "#recycler_view",
  "satellites": ["Battery", "Accessibility", "Passwords &amp; accounts", "Tips &amp; support"],
...
</code></pre>
    <p>This means that the screen is considered as <code>"[Android Settings Top Screen]"</code> when the screen has <code>"#recycler_view"</code> and has at least one of <code>"Battery"</code>, <code>"Accessibility"</code> , <code>"Passwords &amp; accounts"</code> or <code>"Tips &amp; support"</code>. The complex key(consists of identity and satellite key) must be unique over screens.</p>
    <h3>Link</h3>
    <ul>
     <li><a href="using_appium_inspector.html">Using Appium Inspector</a></li>
     <li><a href="../../index.html">index</a></li>
    </ul>
   </article>
  </div>
 </body>
</html>