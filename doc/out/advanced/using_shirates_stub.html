<!doctype html>
<html lang="en">
 <head>
  <meta charset="utf-8">
  <link rel="stylesheet" href="../main.css">
 </head>
 <body>
  <div id="readme" class="Box">
   <article class="markdown-body container-lg">
    <h1>Using shirates-stub</h1>
    <p>You can use <strong>shirates-stub</strong> that provides fake api for testing. You can also change data pattern setting of stub server dinamically using management APIs.</p>
    <p><img src="_images/shirates_stub_overview.png" alt=""></p>
    <h2>Functions</h2>
    <table>
     <thead>
      <tr>
       <th align="left">function</th>
       <th align="left">description</th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td align="left">resetDataPattern</td>
       <td align="left">Reset data pattern</td>
      </tr>
      <tr>
       <td align="left">dataPattern</td>
       <td align="left">Set data pattern</td>
      </tr>
      <tr>
       <td align="left">getDataPattern</td>
       <td align="left">Get data pattern</td>
      </tr>
     </tbody>
    </table>
    <h2>Setting up shirates-stub</h2>
    <p>See <a href="https://github.com/ldi-github/shirates-stub.git">shirates-stub</a>.</p>
    <h2>Starting shirates-stub</h2>
    <ol>
     <li>Open shirates-stub project in IntelliJ IDEA.</li>
     <li>Select <code>ApplicationRunKt</code> and click <code>Debug</code>.</li>
    </ol>
    <p><img src="_images/application-run-kt.png" alt=""></p>
    <ol>
     <li>You can see log in console. Click <a href="http://stub1/">http://stub1/</a></li>
     <li>Click <code>Data pattern changer</code>.</li>
     <li><strong>Data pattern changer</strong> is shown.</li>
    </ol>
    <p><img src="_images/data-pattern-changer.png" alt=""></p>
    <h2>Example</h2>
    <ol>
     <li>Open your test project.</li>
     <li>Set <code>stubServerUrl</code> in testConfig file.</li>
    </ol>
    <pre><code>  "stubServerUrl": "http://stub1",
</code></pre>
    <h3>stubExampleConfig.json</h3>
    <pre><code>{
  "testConfigName": "stubExampleConfig",

  "stubServerUrl": "http://stub1",

  "appIconName": "Settings",

  "packageOrBundleId": "com.android.settings",

  "startupPackageOrBundleId": "com.android.settings",
  "startupActivity": "com.android.settings.Settings",

  "capabilities": {
    "language": "en",
    "locale": "US"
  },

  "profiles": [
    {
      "profileName": "Android 12",
      "capabilities": {
      }
    }
  ]

}
</code></pre>
    <p>Instead of using testConfig.json file, you can set <code>stubServerUrl</code> in testrun file.</p>
    <pre><code>## Stub --------------------
stubServerUrl=http://stub1
</code></pre>
    <p><br></p>
    <ol>
     <li>Create test code using functions for changing data pattern.</li>
    </ol>
    <h3>StubProxy1.kt</h3>
    <pre><code class="language-kotlin">@Testrun("testConfig/android/stubExample/testrun.properties")
class StubProxy1 : UITest() {

    @Test
    @Order(10)
    fun stubProxy1() {

        scenario {
            case(1) {
                condition {
                    stubNot {
                        SKIP_SCENARIO("Stub required.")
                    }
                    resetDataPattern()
                }.expectation {
                    getDataPattern("CustomerList")
                        .stringIs("default")
                }
            }
            case(2) {
                condition {
                    dataPattern("CustomerList", "customer/01")
                }.expectation {
                    getDataPattern("CustomerList")
                        .stringIs("customer/01")
                }
            }
        }

    }
}
</code></pre>
    <p><br></p>
    <ol>
     <li>Run shirates-stub.</li>
     <li>Run test code. You can see output in console like this.</li>
    </ol>
    <h3>Console output (shirates-core)</h3>
    <pre><code>...
104	2022/04/27 02:28:01.881	{}	[info]	()	Running scenario ..................................................
105	2022/04/27 02:28:01.881	{}	[info]	()	Startup package: com.android.settings
106	2022/04/27 02:28:01.882	{stubProxy1}	[SCENARIO]	(scenario)	stubProxy1()
107	2022/04/27 02:28:01.882	{stubProxy1-1}	[CASE]	(case)	(1)
108	2022/04/27 02:28:01.882	{stubProxy1-1}	[CONDITION]	(condition)	condition
109	2022/04/27 02:28:02.386	{stubProxy1-1}	[operate]	(resetDataPattern)	Resetting data pattern.
110	2022/04/27 02:28:02.446	{stubProxy1-1}	[EXPECTATION]	(expectation)	expectation
111	2022/04/27 02:28:02.457	{stubProxy1-1}	[OK]	(stringIs)	"default" is "default"
112	2022/04/27 02:28:02.457	{stubProxy1-2}	[CASE]	(case)	(2)
113	2022/04/27 02:28:02.457	{stubProxy1-2}	[CONDITION]	(condition)	condition
114	2022/04/27 02:28:02.457	{stubProxy1-2}	[operate]	(dataPattern)	Setting data pattern. (CustomerList=customer/01)
115	2022/04/27 02:28:02.462	{stubProxy1-2}	[EXPECTATION]	(expectation)	expectation
116	2022/04/27 02:28:02.464	{stubProxy1-2}	[OK]	(stringIs)	"customer/01" is "customer/01"
117	2022/04/27 02:28:02.464	{stubProxy1-2}	[info]	()	test finished.
...
</code></pre>
    <h3>Console output (shirates-stub)</h3>
    <pre><code>...
lineNo	logDateTime	[logType]	&lt;threadId&gt;	apiName	{dataPattern}	elapsed(ms)	message
22	2022/04/27 02:28:02.426	[INFO]	&lt;29&gt;	resetStubDataManager(API)	{}	-	GET http://stub1/management/resetStubDataManager
23	2022/04/27 02:28:02.432	[INFO]	&lt;29&gt;	-	{}	-	Setting urlPath -&gt; dataPatternName
24	2022/04/27 02:28:02.434	[INFO]	&lt;29&gt;	-	{}	-	"/customer/list" -&gt; "default"
25	2022/04/27 02:28:02.435	[INFO]	&lt;29&gt;	-	{}	-	"/product/list" -&gt; "default"
26	2022/04/27 02:28:02.436	[INFO]	&lt;29&gt;	-	{}	-	"/supplier/list" -&gt; "default"
27	2022/04/27 02:28:02.448	[INFO]	&lt;30&gt;	getDataPattern(API)	{}	-	GET http://stub1/management/getDataPattern?apiName=CustomerList
28	2022/04/27 02:28:02.459	[INFO]	&lt;31&gt;	setDataPattern(API)	{}	-	GET http://stub1/management/setDataPattern?apiName=CustomerList&amp;dataPatternName=customer/01
29	2022/04/27 02:28:02.461	[INFO]	&lt;31&gt;	-	{}	-	"/customer/list" -&gt; "customer/01"
30	2022/04/27 02:28:02.463	[INFO]	&lt;32&gt;	getDataPattern(API)	{}	-	GET http://stub1/management/getDataPattern?apiName=CustomerList
...
</code></pre>
    <h3>Link</h3>
    <ul>
     <li><a href="../index.html">index</a></li>
    </ul>
   </article>
  </div>
 </body>
</html>